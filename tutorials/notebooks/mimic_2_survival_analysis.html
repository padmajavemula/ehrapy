<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="MIMIC-II Survival Analysis" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ehrapy.readthedocs.io/en/latest/tutorials/notebooks/mimic_2_survival_analysis.html" />
<meta property="og:site_name" content="ehrapy" />
<meta property="og:description" content="This tutorial explores the MIMIC-II IAC dataset. It was created for the purpose of a case study in the book: Secondary Analysis of Electronic Health Records, published by Springer in 2016. In parti..." />
<meta property="og:image" content="https://ehrapy.readthedocs.io/en/latest//_static/logo.png" />
<meta property="og:image:alt" content="ehrapy" />
<meta name="description" content="This tutorial explores the MIMIC-II IAC dataset. It was created for the purpose of a case study in the book: Secondary Analysis of Electronic Health Records, published by Springer in 2016. In parti..." />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Diabetes 130 Vignette" href="diabetes_130.html" /><link rel="prev" title="MIMIC-II Patient Fate" href="mimic_2_fate.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>MIMIC-II Survival Analysis - ehrapy</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/override.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/sphinx_gallery.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #003262;
  --color-brand-content: #003262;
  --admonition-font-size: var(--font-size-normal);
  --admonition-title-font-size: var(--font-size-normal);
  --code-font-size: var(--font-size--small);
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ehrapy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/ehrapy_pure.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../usage/usage.html">Usage</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/io/ehrapy.io.read_csv.html">ehrapy.io.read_csv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/io/ehrapy.io.read_h5ad.html">ehrapy.io.read_h5ad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/io/ehrapy.io.write.html">ehrapy.io.write</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.mimic_2.html">ehrapy.data.mimic_2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.mimic_3_demo.html">ehrapy.data.mimic_3_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.diabetes_130.html">ehrapy.data.diabetes_130</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.heart_failure.html">ehrapy.data.heart_failure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.chronic_kidney_disease.html">ehrapy.data.chronic_kidney_disease</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.breast_tissue.html">ehrapy.data.breast_tissue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.cervical_cancer_risk_factors.html">ehrapy.data.cervical_cancer_risk_factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.dermatology.html">ehrapy.data.dermatology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.echocardiogram.html">ehrapy.data.echocardiogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.heart_disease.html">ehrapy.data.heart_disease</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.hepatitis.html">ehrapy.data.hepatitis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.statlog_heart.html">ehrapy.data.statlog_heart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.thyroid.html">ehrapy.data.thyroid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.breast_cancer_coimbra.html">ehrapy.data.breast_cancer_coimbra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.parkinson_dataset_with_replicated_acoustic_features.html">ehrapy.data.parkinson_dataset_with_replicated_acoustic_features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.parkinsons.html">ehrapy.data.parkinsons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.parkinsons_disease_classification.html">ehrapy.data.parkinsons_disease_classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/data/ehrapy.data.parkinsons_telemonitoring.html">ehrapy.data.parkinsons_telemonitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.pca.html">ehrapy.preprocessing.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.regress_out.html">ehrapy.preprocessing.regress_out</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.subsample.html">ehrapy.preprocessing.subsample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.highly_variable_features.html">ehrapy.preprocessing.highly_variable_features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.winsorize.html">ehrapy.preprocessing.winsorize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.clip_quantile.html">ehrapy.preprocessing.clip_quantile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.qc_metrics.html">ehrapy.preprocessing.qc_metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.qc_lab_measurements.html">ehrapy.preprocessing.qc_lab_measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.explicit_impute.html">ehrapy.preprocessing.explicit_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.simple_impute.html">ehrapy.preprocessing.simple_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.knn_impute.html">ehrapy.preprocessing.knn_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.miss_forest_impute.html">ehrapy.preprocessing.miss_forest_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.soft_impute.html">ehrapy.preprocessing.soft_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.iterative_svd_impute.html">ehrapy.preprocessing.iterative_svd_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.matrix_factorization_impute.html">ehrapy.preprocessing.matrix_factorization_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.nuclear_norm_minimization_impute.html">ehrapy.preprocessing.nuclear_norm_minimization_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.mice_forest_impute.html">ehrapy.preprocessing.mice_forest_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.encode.html">ehrapy.preprocessing.encode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.undo_encoding.html">ehrapy.preprocessing.undo_encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.log_norm.html">ehrapy.preprocessing.log_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.maxabs_norm.html">ehrapy.preprocessing.maxabs_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.minmax_norm.html">ehrapy.preprocessing.minmax_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.power_norm.html">ehrapy.preprocessing.power_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.quantile_norm.html">ehrapy.preprocessing.quantile_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.robust_scale_norm.html">ehrapy.preprocessing.robust_scale_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.scale_norm.html">ehrapy.preprocessing.scale_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.sqrt_norm.html">ehrapy.preprocessing.sqrt_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.offset_negative_values.html">ehrapy.preprocessing.offset_negative_values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.combat.html">ehrapy.preprocessing.combat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/preprocessing/ehrapy.preprocessing.neighbors.html">ehrapy.preprocessing.neighbors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.pca.html">ehrapy.tools.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.tsne.html">ehrapy.tools.tsne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.umap.html">ehrapy.tools.umap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.draw_graph.html">ehrapy.tools.draw_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.diffmap.html">ehrapy.tools.diffmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.embedding_density.html">ehrapy.tools.embedding_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.leiden.html">ehrapy.tools.leiden</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.louvain.html">ehrapy.tools.louvain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.dendrogram.html">ehrapy.tools.dendrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.dpt.html">ehrapy.tools.dpt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.paga.html">ehrapy.tools.paga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.rank_features_groups.html">ehrapy.tools.rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.filter_rank_features_groups.html">ehrapy.tools.filter_rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.marker_feature_overlap.html">ehrapy.tools.marker_feature_overlap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.ingest.html">ehrapy.tools.ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.Translator.html">ehrapy.tools.Translator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.HPOMapper.html">ehrapy.tools.HPOMapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.MedCAT.html">ehrapy.tools.MedCAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.mc.run_unsupervised_training.html">ehrapy.tools.mc.run_unsupervised_training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.mc.annotate_text.html">ehrapy.tools.mc.annotate_text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.mc.get_annotation_overview.html">ehrapy.tools.mc.get_annotation_overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.ols.html">ehrapy.tools.ols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.glm.html">ehrapy.tools.glm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tools/ehrapy.tools.kmf.html">ehrapy.tools.kmf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.scatter.html">ehrapy.plot.scatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.heatmap.html">ehrapy.plot.heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.dotplot.html">ehrapy.plot.dotplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.tracksplot.html">ehrapy.plot.tracksplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.violin.html">ehrapy.plot.violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.stacked_violin.html">ehrapy.plot.stacked_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.matrixplot.html">ehrapy.plot.matrixplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.clustermap.html">ehrapy.plot.clustermap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.ranking.html">ehrapy.plot.ranking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.dendrogram.html">ehrapy.plot.dendrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.qc_metrics.html">ehrapy.plot.qc_metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.missing_values_matrix.html">ehrapy.plot.missing_values_matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.missing_values_barplot.html">ehrapy.plot.missing_values_barplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.missing_values_heatmap.html">ehrapy.plot.missing_values_heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.missing_values_dendrogram.html">ehrapy.plot.missing_values_dendrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.pca.html">ehrapy.plot.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.pca_loadings.html">ehrapy.plot.pca_loadings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.pca_variance_ratio.html">ehrapy.plot.pca_variance_ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.pca_overview.html">ehrapy.plot.pca_overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.tsne.html">ehrapy.plot.tsne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.umap.html">ehrapy.plot.umap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.diffmap.html">ehrapy.plot.diffmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.draw_graph.html">ehrapy.plot.draw_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.spatial.html">ehrapy.plot.spatial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.embedding.html">ehrapy.plot.embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.embedding_density.html">ehrapy.plot.embedding_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.dpt_groups_pseudotime.html">ehrapy.plot.dpt_groups_pseudotime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.dpt_timeseries.html">ehrapy.plot.dpt_timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.paga.html">ehrapy.plot.paga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.paga_path.html">ehrapy.plot.paga_path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.paga_compare.html">ehrapy.plot.paga_compare</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups.html">ehrapy.plot.rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_violin.html">ehrapy.plot.rank_features_groups_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_stacked_violin.html">ehrapy.plot.rank_features_groups_stacked_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_heatmap.html">ehrapy.plot.rank_features_groups_heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_dotplot.html">ehrapy.plot.rank_features_groups_dotplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_matrixplot.html">ehrapy.plot.rank_features_groups_matrixplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.rank_features_groups_tracksplot.html">ehrapy.plot.rank_features_groups_tracksplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.ols.html">ehrapy.plot.ols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/plot/ehrapy.plot.kmf.html">ehrapy.plot.kmf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.df_to_anndata.html">ehrapy.anndata.df_to_anndata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.anndata_to_df.html">ehrapy.anndata.anndata_to_df</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.move_to_obs.html">ehrapy.anndata.move_to_obs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.delete_from_obs.html">ehrapy.anndata.delete_from_obs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.move_to_x.html">ehrapy.anndata.move_to_x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/anndata/ehrapy.anndata.type_overview.html">ehrapy.anndata.type_overview</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ehrapy_introduction.html">Introduction to ehrapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="mimic_2_introduction.html">MIMIC-II IAC Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="mimic_2_fate.html">MIMIC-II Patient Fate</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">MIMIC-II Survival Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="diabetes_130.html">Diabetes 130 Vignette</a></li>
<li class="toctree-l2"><a class="reference internal" href="medcat.html">Extracting from free text with MedCAT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/theislab/ehrapy/discussions">Discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    p {
        margin-bottom: 0.5rem;
    }
    /* Main index page overview cards */
    /* https://github.com/spatialaudio/nbsphinx/pull/635/files */
    .jp-RenderedHTMLCommon table,
    div.rendered_html table {
    border: none;
    border-collapse: collapse;
    border-spacing: 0;
    font-size: 12px;
    table-layout: fixed;
    color: inherit;
    }

    body:not([data-theme=light]) .jp-RenderedHTMLCommon tbody tr:nth-child(odd),
    body:not([data-theme=light]) div.rendered_html tbody tr:nth-child(odd) {
    background: rgba(255, 255, 255, .1);
    }
</style><div class="admonition note">
    <p class="admonition-title">Note</p>
    <p>
    This page was generated from
    <a class="reference external" href="https://github.com/theislab/ehrapy/tree/0.3.0/">mimic_2_survival_analysis.ipynb</a>.
    Some tutorial content may look better in light mode.
    </p>
</div><section id="MIMIC-II-Survival-Analysis">
<h1>MIMIC-II Survival Analysis<a class="headerlink" href="#MIMIC-II-Survival-Analysis" title="Permalink to this heading">#</a></h1>
<p>This tutorial explores the MIMIC-II IAC dataset. It was created for the purpose of a case study in the book: Secondary Analysis of Electronic Health Records, published by Springer in 2016. In particular, the dataset was used throughout Chapter 16 (Data Analysis) by Raffa J. et al. to investigate the effectiveness of indwelling arterial catheters in hemodynamically stable patients with respiratory failure for mortality outcomes. The dataset is derived from MIMIC-II, the publicly-accessible
critical care database. It contains summary clinical data and outcomes for 1,776 patients.</p>
<p>Reference:</p>
<p>[1] Critical Data, M.I.T., 2016. Secondary analysis of electronic health records (p. 427). Springer Nature. (<a class="reference external" href="https://link.springer.com/book/10.1007/978-3-319-43742-2">https://link.springer.com/book/10.1007/978-3-319-43742-2</a>)</p>
<p>[2] <a class="reference external" href="https://github.com/MIT-LCP/critical-data-book/tree/master/part_ii/chapter_16/jupyter">https://github.com/MIT-LCP/critical-data-book/tree/master/part_ii/chapter_16/jupyter</a></p>
<p>[3] <a class="reference external" href="https://stackoverflow.com/questions/27328623/anova-test-for-glm-in-python/60769343#60769343">https://stackoverflow.com/questions/27328623/anova-test-for-glm-in-python/60769343#60769343</a></p>
<p>More details on the dataset can be found here: <a class="reference external" href="https://physionet.org/content/mimic2-iaccd/1.0/">https://physionet.org/content/mimic2-iaccd/1.0/</a>.</p>
<section id="Importing-ehrapy-and-setting-plotting-parameters">
<h2>Importing ehrapy and setting plotting parameters<a class="headerlink" href="#Importing-ehrapy-and-setting-plotting-parameters" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import ehrapy as ep
from tabulate import tabulate
import pandas as pd
import numpy as np
from statsmodels.stats.anova import anova_lm
from itertools import product
from lifelines import CoxPHFitter
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import warnings

warnings.filterwarnings(&quot;ignore&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ep.print_versions()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">-----
ehrapy              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
rich                NA
scanpy              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.9</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
session_info        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
-----
PIL                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
PyPDF2              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.27</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span>
anndata             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
appnope             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>
astor               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.7</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
asttokens           NA
attr                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.4</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
autograd            NA
autograd_gamma      NA
backcall            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
backports           NA
bs4                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.11</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
camelot             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.10</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
category_encoders   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.4</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
certifi             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2021.10</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">08</span>
cffi                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.15</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
chardet             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
charset_normalizer  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span>
colorama            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>
cryptography        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
cv2                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.5</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>
cvxopt              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
cycler              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.10</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
cython_runtime      NA
dateutil            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
debugpy             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
decorator           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
deep_translator     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
deepl               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
defusedxml          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.7</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
entrypoints         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4</span>
executing           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>
formulaic           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>
future              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.18</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
h5py                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.6</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
idna                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span>
igraph              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.9</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span>
interface_meta      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
ipykernel           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.13</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
jedi                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.18</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
joblib              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
kiwisolver          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
leidenalg           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span>
lifelines           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.27</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
llvmlite            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.34</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
matplotlib          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.5</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
matplotlib_inline   NA
mpl_toolkits        NA
mudata              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
natsort             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
numba               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.51</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
numpy               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.22</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>
packaging           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.3</span>
pandas              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>
parso               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>
patsy               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
pdfminer            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20220319</span>
pexpect             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
pickleshare         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.7</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>
pkg_resources       NA
prompt_toolkit      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29</span>
psutil              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.9</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
ptyprocess          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.7</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
pure_eval           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
pydantic            NA
pydev_ipython       NA
pydevconsole        NA
pydevd              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
pydevd_file_utils   NA
pydevd_plugins      NA
pydevd_tracing      NA
pygments            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.11</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
pyhpo               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
pyparsing           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span>
pypi_latest         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
pytz                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2022.1</span>
questionary         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.10</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
requests            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.27</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
ruamel              NA
scipy               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
setuptools          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
setuptools_scm      NA
six                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.16</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
sklearn             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
soupsieve           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.</span>post1
sphinxcontrib       NA
stack_data          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
statsmodels         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.13</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
tabulate            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span>
texttable           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>
threadpoolctl       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
tornado             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.1</span>
traitlets           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.1</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
typing_extensions   NA
urllib3             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.26</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span>
wcwidth             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span>
wrapt               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.14</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
yaml                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.0</span>
zipp                NA
zmq                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22.3</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
-----
IPython             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
jupyter_client      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.2</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>
jupyter_core        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.10</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>
-----
Python <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> <span style="font-weight: bold">(</span>default, Apr <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2021</span>, <span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">12:59:45</span><span style="font-weight: bold">)</span> <span style="font-weight: bold">[</span>Clang <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.0</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> <span style="font-weight: bold">]</span>
macOS-<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.16</span>-x86_64-i386-64bit
-----
Session information updated at <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2022</span>-<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">05</span>-<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> <span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">11:36</span>

</pre></div>
</div>
</section>
<section id="MIMIC-II-dataset-preparation">
<h2>MIMIC-II dataset preparation<a class="headerlink" href="#MIMIC-II-dataset-preparation" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata = ep.dt.mimic_2(encoded=False)
</pre></div>
</div>
</div>
<p>It is also possible to get the MIMIC-II dataset already pre-encoded by setting the encoded flag to ‘True’. ehrapy’s default encoding is a simple label encoding in this case.</p>
<p>The MIMIC-II dataset has 1776 patients as described above with 46 features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AnnData object with n_obs × n_vars = 1776 × 46
    uns: &#39;numerical_columns&#39;, &#39;non_numerical_columns&#39;
    layers: &#39;original&#39;
</pre></div></div>
</div>
<p>After one-hot encoding the two columns we’ve expanded our matrix from 46 to 54 features. Let’s verify that we’ve indeed encoded all columns and are ready to proceed.</p>
</section>
<section id="Linear-Regression">
<h2>Linear Regression<a class="headerlink" href="#Linear-Regression" title="Permalink to this heading">#</a></h2>
<section id="Introduction">
<h3>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">#</a></h3>
<p>Linear regression provides the foundation for many types of analyses we perform on health data. In the simplest scenario, we try to relate one continuous outcome, <span class="math notranslate nohighlight">\(y\)</span>, to a single continuous covariate, <span class="math notranslate nohighlight">\(x\)</span>, by trying to find values for <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span> so that the following equation: <span class="math notranslate nohighlight">\(y=\beta_0 + \beta_1 \times x\)</span></p>
<p>It is always a good idea to visualize the data when you can, which allows one to assess if the subsequent analysis corresponds to what you could see with your eyes. In this case, a scatter plot has been used, producing the scattered points:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ax = ep.pl.scatter(adata, x=&quot;pco2_first&quot;, y=&quot;tco2_first&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_17_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_17_0.png" />
</div>
</div>
<p>Finding the best fit line for the scatter plot above using <code class="docutils literal notranslate"><span class="pre">ep.tl.ols</span> <span class="pre">(ehrapy.tools.ols)</span></code> is relatively straightforward:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_names = [&quot;pco2_first&quot;, &quot;tco2_first&quot;, &quot;gender_num&quot;]
formula = &quot;tco2_first ~ pco2_first&quot;
co2_lm = ep.tl.ols(adata, var_names, formula, missing=&quot;drop&quot;)
</pre></div>
</div>
</div>
<p>Dissecting this command from left to right. The <code class="docutils literal notranslate"><span class="pre">co2_lm</span> <span class="pre">=</span></code> part assigns the right part of the command to a new variable called <code class="docutils literal notranslate"><span class="pre">co2_lm</span></code>. The right side of this command runs the <code class="docutils literal notranslate"><span class="pre">OLS</span></code> function in <code class="docutils literal notranslate"><span class="pre">Python</span></code>. The basic <code class="docutils literal notranslate"><span class="pre">OLS</span></code> command has two parts. The first is the formula which has the general syntax <code class="docutils literal notranslate"><span class="pre">outcome</span> <span class="pre">~</span> <span class="pre">covariates</span></code>. Here, our outcome variable is called <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> and we are just fitting one covariate, <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>, so our formula is <code class="docutils literal notranslate"><span class="pre">tco2_first</span> <span class="pre">~</span> <span class="pre">pco2_first</span></code>. The second
argument is separated by a comma and is specifying the data frame to use. In our case, the data frame is called <code class="docutils literal notranslate"><span class="pre">dat</span></code>, so we pass <code class="docutils literal notranslate"><span class="pre">data=dat</span></code>, noting that both <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> and <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> are columns in the dataframe <code class="docutils literal notranslate"><span class="pre">dat</span></code>. The overall procedure of specifying a model formula (<code class="docutils literal notranslate"><span class="pre">tco2_first</span> <span class="pre">~</span> <span class="pre">pco2_first</span></code>), a data frame (<code class="docutils literal notranslate"><span class="pre">data=dat</span></code>) and passing it an appropriate <code class="docutils literal notranslate"><span class="pre">Python</span></code> function (<code class="docutils literal notranslate"><span class="pre">OLS</span></code>) will be used throughout this chapter, and is the foundation for many types of statistical
modeling in <code class="docutils literal notranslate"><span class="pre">Python</span></code>.</p>
<p>We would like to see some information about the model we just fit, and often a good way of doing this is to run the <code class="docutils literal notranslate"><span class="pre">summary</span></code> command on the object we created:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>co2_lm_result = co2_lm.fit()
co2_lm_result.summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>tco2_first</td>    <th>  R-squared:         </th> <td>   0.265</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.264</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   571.8</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 25 May 2022</td> <th>  Prob (F-statistic):</th> <td>3.52e-108</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:36:03</td>     <th>  Log-Likelihood:    </th> <td> -4609.1</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1590</td>      <th>  AIC:               </th> <td>   9222.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1588</td>      <th>  BIC:               </th> <td>   9233.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>  <td>   16.2109</td> <td>    0.360</td> <td>   45.071</td> <td> 0.000</td> <td>   15.505</td> <td>   16.916</td>
</tr>
<tr>
  <th>pco2_first</th> <td>    0.1886</td> <td>    0.008</td> <td>   23.912</td> <td> 0.000</td> <td>    0.173</td> <td>    0.204</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>94.233</td> <th>  Durbin-Watson:     </th> <td>   1.963</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 195.722</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.389</td> <th>  Prob(JB):          </th> <td>3.16e-43</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.532</td> <th>  Cond. No.          </th> <td>    149.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div>
</div>
<p>This outputs information about the <code class="docutils literal notranslate"><span class="pre">OSL</span></code> object we created in the previous step. The first part recalls the model we fit, which is useful when we have fit many models, and are trying to compare them. The second part lists some summary information about what are called residuals – a topic we will cover later on in this book (Chapter 2.6). Next lists the coefficient estimates – these are the <span class="math notranslate nohighlight">\(\hat{\beta}_0\)</span>, <code class="docutils literal notranslate"><span class="pre">(Intercept)</span></code>, and <span class="math notranslate nohighlight">\(\hat{\beta}_1\)</span>, <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>, parameters in the best
fit line we are trying to estimate. This output is telling us that the best fit equation for the data is:</p>
<p><code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = 16.21 + 0.189 <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>.</p>
</section>
<section id="Model-Selection">
<h3>Model Selection<a class="headerlink" href="#Model-Selection" title="Permalink to this heading">#</a></h3>
<p>Model selection are techniques related to selecting the best model from a list (perhaps rather large list) of candidate models. We will cover some basics here, as more complicated techniques will be covered in a later chapter. In the simplest case, we have two models, and we want to know which one we should use.</p>
<p>We will begin by examining if the relationship between TCO2 and PCO2 is more complicated than the model we fit in the previous section. If you recall, we fit a model where we considered a linear <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> term: <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = <span class="math notranslate nohighlight">\(\beta_0 + \beta_1 \times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>. One may wonder if including a quadratic term would fit the data better, i.e. whether:</p>
<p><code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = <span class="math notranslate nohighlight">\(\beta_0 + \beta_1 \times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> + <span class="math notranslate nohighlight">\(\beta_2 \times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code><span class="math notranslate nohighlight">\(^2\)</span>,</p>
<p>is a better model.</p>
<p>Adding a quadratic term (or any other function) is quite easy using the <code class="docutils literal notranslate"><span class="pre">OLS</span></code> function. Fitting this model, and running the <code class="docutils literal notranslate"><span class="pre">summary</span></code> function for the model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;tco2_first ~ pco2_first + np.square(pco2_first)&quot;

o2_quad_lm = ep.tl.ols(adata, var_names, formula, missing=&quot;drop&quot;)
co2_quad_lm_result = o2_quad_lm.fit()
co2_quad_lm_result.summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>tco2_first</td>    <th>  R-squared:         </th> <td>   0.265</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.264</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   285.7</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 25 May 2022</td> <th>  Prob (F-statistic):</th> <td>1.04e-106</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:36:03</td>     <th>  Log-Likelihood:    </th> <td> -4609.1</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1590</td>      <th>  AIC:               </th> <td>   9224.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1587</td>      <th>  BIC:               </th> <td>   9240.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
            <td></td>               <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>             <td>   16.0916</td> <td>    0.771</td> <td>   20.862</td> <td> 0.000</td> <td>   14.579</td> <td>   17.605</td>
</tr>
<tr>
  <th>pco2_first</th>            <td>    0.1930</td> <td>    0.027</td> <td>    7.231</td> <td> 0.000</td> <td>    0.141</td> <td>    0.245</td>
</tr>
<tr>
  <th>np.square(pco2_first)</th> <td>-3.569e-05</td> <td>    0.000</td> <td>   -0.175</td> <td> 0.861</td> <td>   -0.000</td> <td>    0.000</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>93.522</td> <th>  Durbin-Watson:     </th> <td>   1.963</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 194.937</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.385</td> <th>  Prob(JB):          </th> <td>4.68e-43</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.533</td> <th>  Cond. No.          </th> <td>1.94e+04</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 1.94e+04. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div>
</div>
<p>Looking first at the coefficients estimates, we see the best fit line is estimated as:</p>
<p><code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = 16.09 + 0.19 <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> + 0.00004 <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code><span class="math notranslate nohighlight">\(^2\)</span>.</p>
<p>We can add both best fit lines to the former scattered points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ep.pl.ols(
    adata,
    x=&quot;pco2_first&quot;,
    y=&quot;tco2_first&quot;,
    ols_results=[co2_lm_result, co2_quad_lm_result],
    ols_color=[&quot;red&quot;, &quot;blue&quot;],
    xlabel=&quot;PCO2&quot;,
    ylabel=&quot;TCO2&quot;,
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_29_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_29_0.png" />
</div>
</div>
<p>Figure Scatterplot of PCO2 (x-axis) and TCO2 (y-axis) along with linear regression estimates from the quadratic model (co2_quad_lm) and linear only model (co2_lm)</p>
<p>And one can see that the red (linear term only) and blue (linear and quadratic terms) fits are nearly identical. This corresponds with the relatively small coefficient estimate for the <code class="docutils literal notranslate"><span class="pre">(pco2_first^2)</span></code> term. The p-value for this coefficient is about 0.86, and at the 0.05 significance level we would likely conclude that a quadratic term is not necessary in our model to fit the data, as the linear term only model fits the data nearly as well.</p>
<section id="Statistical-Interactions-and-Testing-Nested-Models">
<h4>Statistical Interactions and Testing Nested Models<a class="headerlink" href="#Statistical-Interactions-and-Testing-Nested-Models" title="Permalink to this heading">#</a></h4>
<p>First the model with gender as a covariate, but no interaction. We can do this by simply adding the variable <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> to the previous formula for our <code class="docutils literal notranslate"><span class="pre">co2_lm</span></code> model fit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;tco2_first ~ pco2_first + gender_num&quot;
var_names = [&quot;tco2_first&quot;, &quot;pco2_first&quot;, &quot;gender_num&quot;]
co2_gender_lm = ep.tl.ols(adata, var_names, formula, missing=&quot;drop&quot;)
co2_gender_lm_result = co2_gender_lm.fit()
co2_gender_lm_result.summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>tco2_first</td>    <th>  R-squared:         </th> <td>   0.265</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.264</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   286.1</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 25 May 2022</td> <th>  Prob (F-statistic):</th> <td>7.60e-107</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:36:03</td>     <th>  Log-Likelihood:    </th> <td> -4608.7</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1590</td>      <th>  AIC:               </th> <td>   9223.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1587</td>      <th>  BIC:               </th> <td>   9240.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
       <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>  <td>   16.3044</td> <td>    0.378</td> <td>   43.166</td> <td> 0.000</td> <td>   15.564</td> <td>   17.045</td>
</tr>
<tr>
  <th>pco2_first</th> <td>    0.1889</td> <td>    0.008</td> <td>   23.922</td> <td> 0.000</td> <td>    0.173</td> <td>    0.204</td>
</tr>
<tr>
  <th>gender_num</th> <td>   -0.1817</td> <td>    0.224</td> <td>   -0.812</td> <td> 0.417</td> <td>   -0.621</td> <td>    0.257</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>94.658</td> <th>  Durbin-Watson:     </th> <td>   1.964</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 194.982</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.394</td> <th>  Prob(JB):          </th> <td>4.57e-43</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.524</td> <th>  Cond. No.          </th> <td>    160.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div>
</div>
<p>This output is very similar to what we had before, but now there’s a <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> term as well. The <code class="docutils literal notranslate"><span class="pre">1</span></code> is present in the first column after <code class="docutils literal notranslate"><span class="pre">gender_num</span></code>, and it tells us who this coefficient is relevant to (subjects with <code class="docutils literal notranslate"><span class="pre">1</span></code> for the <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> – men). This is always relative to the baseline group, and in this case this is women. The estimate is negative, meaning that the line fit for males will be below the line for females. Plotting this fit curve:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># s stands for slope of the line, i stands for intercept of the line
s_female = co2_gender_lm_result.params[1]
i_female = co2_gender_lm_result.params[0]
s_male = co2_gender_lm_result.params[1]
i_male = co2_gender_lm_result.params[0] + co2_gender_lm_result.params[2]
ep.pl.ols(
    lines=[(s_female, i_female), (s_male, i_male)],
    lines_color=[&quot;k&quot;, &quot;r&quot;],
    lines_label=[&quot;Female&quot;, &quot;Male&quot;],
    xlabel=&quot;PCO2&quot;,
    ylabel=&quot;TCO2&quot;,
    xlim=(0, 40),
    ylim=(15, 25),
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_36_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_36_0.png" />
</div>
</div>
<p>We see that the lines are parallel, but almost indistinguishable. In fact, this plot has been cropped in order to see any difference at all. From the estimate from the <code class="docutils literal notranslate"><span class="pre">summary</span></code> output above, the difference between the two lines is -0.182 mmol/L, which is quite small, so perhaps this isn’t too surprising. We can also see in the above <code class="docutils literal notranslate"><span class="pre">summary</span></code> output that the p-value is about 0.42, and we would likely <em>not</em> reject the null hypothesis that the true value of the <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> coefficient is
zero.</p>
<p>And now moving on to the model with an interaction between <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> and <code class="docutils literal notranslate"><span class="pre">gender_num</span></code>. To add an interaction between two variables use the <code class="docutils literal notranslate"><span class="pre">*</span></code> operator within a model formula. By default, <code class="docutils literal notranslate"><span class="pre">Python</span></code> will add all of the main effects (variables contained in the interaction) to the model as well, so simply adding <code class="docutils literal notranslate"><span class="pre">pco2_first*gender_num</span></code> will add effects for <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> and <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> in addition to the interaction between them to the model fit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;tco2_first ~ pco2_first * gender_num&quot;
var_names = [&quot;tco2_first&quot;, &quot;pco2_first&quot;, &quot;gender_num&quot;]

co2_gender_interaction_lm = ep.tl.ols(adata, var_names, formula, missing=&quot;drop&quot;)
co2_gender_interaction_lm_result = co2_gender_interaction_lm.fit()
co2_gender_interaction_lm_result.summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>tco2_first</td>    <th>  R-squared:         </th> <td>   0.266</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.265</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   191.6</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 25 May 2022</td> <th>  Prob (F-statistic):</th> <td>5.09e-106</td>
</tr>
<tr>
  <th>Time:</th>                 <td>11:36:04</td>     <th>  Log-Likelihood:    </th> <td> -4607.7</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1590</td>      <th>  AIC:               </th> <td>   9223.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1586</td>      <th>  BIC:               </th> <td>   9245.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     3</td>      <th>                     </th>     <td> </td>
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>
</tr>
</table>
<table class="simpletable">
<tr>
            <td></td>               <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>
</tr>
<tr>
  <th>Intercept</th>             <td>   15.8544</td> <td>    0.489</td> <td>   32.443</td> <td> 0.000</td> <td>   14.896</td> <td>   16.813</td>
</tr>
<tr>
  <th>pco2_first</th>            <td>    0.1994</td> <td>    0.011</td> <td>   18.585</td> <td> 0.000</td> <td>    0.178</td> <td>    0.220</td>
</tr>
<tr>
  <th>gender_num</th>            <td>    0.8144</td> <td>    0.722</td> <td>    1.128</td> <td> 0.260</td> <td>   -0.602</td> <td>    2.231</td>
</tr>
<tr>
  <th>pco2_first:gender_num</th> <td>   -0.0230</td> <td>    0.016</td> <td>   -1.450</td> <td> 0.147</td> <td>   -0.054</td> <td>    0.008</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>97.108</td> <th>  Durbin-Watson:     </th> <td>   1.964</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 200.324</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.403</td> <th>  Prob(JB):          </th> <td>3.16e-44</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.541</td> <th>  Cond. No.          </th> <td>    399.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div>
</div>
<p>The estimated coefficients are <span class="math notranslate nohighlight">\(\hat{\beta}_0, \hat{\beta}_1, \hat{\beta}_2\)</span> and <span class="math notranslate nohighlight">\(\hat{\beta}_3\)</span>, respectively, and we can determine the best fit lines for men:</p>
<p><code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = <span class="math notranslate nohighlight">\((15.85 + 0.81)\)</span> + <span class="math notranslate nohighlight">\((0.20 - 0.023)\)</span> <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> = <span class="math notranslate nohighlight">\(16.67\)</span> + <span class="math notranslate nohighlight">\(0.18\)</span> <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>,</p>
<p>and for women:</p>
<p><code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> = <span class="math notranslate nohighlight">\(15.85\)</span> + <span class="math notranslate nohighlight">\(0.20\)</span> <span class="math notranslate nohighlight">\(\times\)</span> <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>.</p>
<p>Based on this, the men’s intercept should be higher, but their slope should be not as steep, relative to the women. Let’s check this and add the new model fits as dotted lines and add a legend to the above figure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># s stands for slope of the line, i stands for intercept of the line
s_female_interaction = co2_gender_interaction_lm_result.params[1]
i_female_interaction = co2_gender_interaction_lm_result.params[0]
s_male_interaction = (
    co2_gender_interaction_lm_result.params[1]
    + co2_gender_interaction_lm_result.params[3]
)
i_male_interaction = (
    co2_gender_interaction_lm_result.params[0]
    + co2_gender_interaction_lm_result.params[2]
)

lines = [
    (s_female, i_female),
    (s_male, i_male),
    (s_female_interaction, i_female_interaction),
    (s_male_interaction, i_male_interaction),
]
lines_color = [&quot;k&quot;, &quot;r&quot;, &quot;k&quot;, &quot;r&quot;]
lines_style = [&quot;-&quot;, &quot;-&quot;, &quot;:&quot;, &quot;:&quot;]
lines_label = [
    &quot;Female&quot;,
    &quot;Male&quot;,
    &quot;Female (Interaction Model)&quot;,
    &quot;Male (Interaction Model)&quot;,
]
ep.pl.ols(
    lines=lines,
    lines_color=lines_color,
    lines_style=lines_style,
    lines_label=lines_label,
    xlabel=&quot;PCO2&quot;,
    ylabel=&quot;TCO2&quot;,
    xlim=(0, 40),
    ylim=(15, 25),
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_41_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_41_0.png" />
</div>
</div>
<p>Regression fits of PCO2 on TCO2 with gender (black female; red male; solid no interaction; dotted with interaction). Note Both axes are cropped for illustration purposes</p>
<p>We can see that the fits generated from this plot are a little different than the one generated for a model without the interaction. The biggest difference is that the dotted lines are no longer parallel. This has some serious implications, particularly when it comes to interpreting our result. First note that the estimated coefficient for the <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> variable is now positive. This means that at <code class="docutils literal notranslate"><span class="pre">pco2_first=0</span></code>, men (red) have higher <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> levels than women (black). If you
recall in the previous model fit, women had higher levels of <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> at all levels of <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>. At some point around <code class="docutils literal notranslate"><span class="pre">pco2_first=35</span></code> this changes and women (black) have higher <code class="docutils literal notranslate"><span class="pre">tco2_first</span></code> levels than men (red). This means that the effect of <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> <em>may</em> vary as you change the level of <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>, and is why interactions are often referred to as effect modification in the epidemiological literature. The effect need not change signs (i.e., the lines do not need to
cross) over the observed range of values for an interaction to be present.</p>
<p>The question remains, is the variable <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> important? We looked at this briefly when we examined the <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">value</span></code> column in the no interaction model which included <code class="docutils literal notranslate"><span class="pre">gender_num</span></code>. What if we wanted to test (simultaneously) the null hypothesis: <span class="math notranslate nohighlight">\(\beta_2\)</span> <em>and</em> <span class="math notranslate nohighlight">\(\beta_3=0\)</span> There is a useful test known as the F-test which can help us in this exact scenario where we want to look at if we should use a larger model (more covariates) or use a smaller model (fewer covariates). The
F-test applies only to <em>nested models</em> – the larger model <em>must</em> contain each covariate that is used in the smaller model, and the smaller model <em>cannot</em> contain covariates which are not in the larger model. The interaction model and the model with gender are nested models since the all the covariates in the model with gender are also in the larger interaction model. An example of a non-nested model would be the quadratic model and the interaction model: the smaller (quadratic) model has a term
(<code class="docutils literal notranslate"><span class="pre">pco2_first</span></code><span class="math notranslate nohighlight">\(^2\)</span>) which is not in the larger (interaction) model. An F-test would not be appropriate for this latter case.</p>
<p>To perform an F-test, first fit the two models you wish to consider, and then run the <code class="docutils literal notranslate"><span class="pre">anova_lm</span></code> command passing the two model objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>anova_lm(co2_lm_result, co2_gender_interaction_lm_result)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>df_resid</th>
      <th>ssr</th>
      <th>df_diff</th>
      <th>ss_diff</th>
      <th>F</th>
      <th>Pr(&gt;F)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1588.0</td>
      <td>30674.431382</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1586.0</td>
      <td>30621.082804</td>
      <td>2.0</td>
      <td>53.348578</td>
      <td>1.381578</td>
      <td>0.251484</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As you can see, the <code class="docutils literal notranslate"><span class="pre">anova_lm</span></code> command first lists the models it is considering. Much of the rest of the information is beyond the scope of this chapter, but we will highlight the reported F-test p-value (<code class="docutils literal notranslate"><span class="pre">Pr(&gt;F)</span></code>), which in this case is 0.2515. In nested models, the null hypothesis is that all coefficients in the larger model and not in the smaller model are zero. In the case we are testing, our null hypothesis is <span class="math notranslate nohighlight">\(\beta_2\)</span> <em>and</em> <span class="math notranslate nohighlight">\(\beta_3=0\)</span>. Since the p-value exceeds the
typically used significance level (<span class="math notranslate nohighlight">\(\alpha=0.05\)</span>), we would not reject the null hypothesis, and likely say the smaller model explains the data just as well as the larger model. If these were the only models we were considering, we would use the smaller model as our final model and report the final model in our results. We will now discuss what exactly you should report and how you can interpret the results.</p>
</section>
</section>
<section id="Reporting-and-Interpreting-Linear-Regression">
<h3>Reporting and Interpreting Linear Regression<a class="headerlink" href="#Reporting-and-Interpreting-Linear-Regression" title="Permalink to this heading">#</a></h3>
<p>Confidence and Prediction Intervals</p>
<p>As mentioned above, one method to quantify the uncertainty around coefficient estimates is by reporting the standard error. Another commonly used method is to report a confidence interval, most commonly a 95% confidence interval. A 95% confidence interval for <span class="math notranslate nohighlight">\(\beta\)</span> is an interval for which if the data were collected repeatedly, about 95% of the <em>intervals</em> would contain the <em>true value</em> of the parameter, <span class="math notranslate nohighlight">\(\beta\)</span>, assuming the modeling assumptions are correct.</p>
<p>To get 95% confidence intervals of coefficients, <code class="docutils literal notranslate"><span class="pre">Python</span></code> has a <code class="docutils literal notranslate"><span class="pre">confint</span></code> function, which you pass an <code class="docutils literal notranslate"><span class="pre">lm</span></code> object to. It will then output 2.5% and 97.5% confidence interval limits for each coefficient.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>co2_lm_result.conf_int()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>15.505369</td>
      <td>16.916349</td>
    </tr>
    <tr>
      <th>pco2_first</th>
      <td>0.173103</td>
      <td>0.204040</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The 95% confidence interval for <code class="docutils literal notranslate"><span class="pre">pco2_first</span></code> is about 0.17-0.20, which may be slightly more informative than reporting the standard error. Often people will look at if the confidence interval includes zero (no effect). Since it does not, and in fact since the interval is quite narrow and not very close to zero, this provides some additional evidence of its importance. There is a well known link between hypothesis testing and confidence intervals which we will not get into detail here.</p>
<p>When plotting the data with the model fit, similar to Figure 16.2, it is a good idea to include some sort of assessment of uncertainty as well. To do this in <code class="docutils literal notranslate"><span class="pre">Python</span></code>, we will first create a data frame with PCO2 levels which we would like to predict. In this case, we would like to predict the outcome (TCO2) over the range of observed covariate (PCO2) values. We do this by creating a data frame, where the variable names in the data frame must match the covariates used in the model. In our case,
we have only one covariate (<code class="docutils literal notranslate"><span class="pre">pco2_first</span></code>), and we predict the outcome over the range of covariate values we observed determined by the <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> functions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pco2_first = pd.DataFrame(adata[:, &quot;pco2_first&quot;].X).dropna().astype(int)
data = {&quot;pco2_first&quot;: [i for i in range(pco2_first.min()[0], pco2_first.max()[0])]}
grid_pred = pd.DataFrame(data)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>preds = co2_lm_result.get_prediction(grid_pred).summary_frame()[
    [&quot;mean&quot;, &quot;obs_ci_lower&quot;, &quot;obs_ci_upper&quot;]
]
preds[0:2]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>obs_ci_lower</th>
      <th>obs_ci_upper</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.719434</td>
      <td>9.078647</td>
      <td>26.360220</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17.908005</td>
      <td>9.268186</td>
      <td>26.547825</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We have printed out the first two rows of our predictions, preds, which are the model’s predictions for PCO2 at 8 and 9. We can see that our predictions (mean) are about 0.18 apart, which make sense given our estimate of the slope (0.18). We also see that our 95 % prediction intervals are very wide, spanning about 9 (obs_ci_lower) to 26 (obs_ci_upper). This indicates that, despite coming up with a model which is very statisti- cally significant, we still have a lot of uncertainty about the
predictions generated from such a model. It is a good idea to capture this quality when plotting how well your model fits by adding the interval lines as dotted lines. Let’s plot our final model fit, co2.lm, along with the scatterplot and prediction interval in the figure below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ep.pl.ols(
    adata,
    x=&quot;pco2_first&quot;,
    y=&quot;tco2_first&quot;,
    ols_results=[co2_lm_result],
    ols_color=[&quot;red&quot;],
    lines=[
        (grid_pred[&quot;pco2_first&quot;], preds[&quot;obs_ci_upper&quot;]),
        (grid_pred[&quot;pco2_first&quot;], preds[&quot;obs_ci_lower&quot;]),
    ],
    lines_color=[&quot;k&quot;, &quot;k&quot;],
    lines_style=[&quot;--&quot;, &quot;--&quot;],
    xlabel=&quot;PCO2&quot;,
    ylabel=&quot;TCO2&quot;,
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_54_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_54_0.png" />
</div>
</div>
<p>Scatterplot of PCO2 (x-axis) and TCO2 (y-axis) along with linear regression estimates from the linear only model (co2_lm). The dotted line represents 95 % prediction intervals for the model</p>
</section>
</section>
<section id="Logistic-Regression">
<h2>Logistic Regression<a class="headerlink" href="#Logistic-Regression" title="Permalink to this heading">#</a></h2>
<section id="2-*-2-Tables">
<h3>2 * 2 Tables<a class="headerlink" href="#2-*-2-Tables" title="Permalink to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>var_names = [&quot;age&quot;, &quot;day_28_flg&quot;, &quot;service_unit&quot;]
dat = pd.DataFrame(adata[:, var_names].X, columns=var_names)
dat[&quot;age&quot;] = dat[&quot;age&quot;].astype(&quot;float&quot;).dropna(axis=0)
</pre></div>
</div>
</div>
<p>Contingency tables are the best way to start to think about binary data. A contingency table cross-tabulates the outcome across two or more levels of a covariate. Let’s begin by creating a new variable (<code class="docutils literal notranslate"><span class="pre">age.cat</span></code>) which dichotomizes <code class="docutils literal notranslate"><span class="pre">age</span></code> into two age categories: <span class="math notranslate nohighlight">\(\le55\)</span> and <span class="math notranslate nohighlight">\(&gt;55\)</span>. Note, because we are making age a discrete variable, we also change the data type to a factor. This is similar to what we did for the <code class="docutils literal notranslate"><span class="pre">gender_num</span></code> variable when discussing linear regression in the
previous subchapter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dat[&quot;age_cat&quot;] = np.where(dat[&quot;age&quot;] &lt;= 55, &quot;&lt;=55&quot;, &quot;&gt;55&quot;)
dat[&quot;age_cat&quot;] = dat[&quot;age_cat&quot;].astype(&quot;category&quot;)
dat[&quot;age_cat&quot;].value_counts()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;=55    923
&gt;55     853
Name: age_cat, dtype: int64
</pre></div></div>
</div>
<p>We would like to see how 28 day mortality is distributed among the age categories. We can do so by constructing a contingency table, or in this case what is commonly referred to as a 2x2 table.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>age_cat_day_28_flg = pd.crosstab(index=dat[&quot;age_cat&quot;], columns=dat[&quot;day_28_flg&quot;])
age_cat_day_28_flg.columns = [&quot;0&quot;, &quot;1&quot;]
age_cat_day_28_flg.index = [&quot;&lt;=55&quot;, &quot;&gt;55&quot;]
age_cat_day_28_flg
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>&lt;=55</th>
      <td>883</td>
      <td>40</td>
    </tr>
    <tr>
      <th>&gt;55</th>
      <td>610</td>
      <td>243</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now let us look at a slightly different case – when the covariate takes on more than two values. Such a variable is the <code class="docutils literal notranslate"><span class="pre">service_unit</span></code>. Let’s see how the deaths are distributed among the different units:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>deathbyservice = pd.crosstab(index=dat[&quot;service_unit&quot;], columns=dat[&quot;day_28_flg&quot;])
deathbyservice.columns = [&quot;0&quot;, &quot;1&quot;]
deathbyservice.index = [&quot;FICU&quot;, &quot;MICU&quot;, &quot;SICU&quot;]
deathbyservice
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FICU</th>
      <td>59</td>
      <td>3</td>
    </tr>
    <tr>
      <th>MICU</th>
      <td>605</td>
      <td>127</td>
    </tr>
    <tr>
      <th>SICU</th>
      <td>829</td>
      <td>153</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>we can get frequencies of these service units by applying the <code class="docutils literal notranslate"><span class="pre">prop.table</span></code> function to our cross-tabulated table.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>deathbyservice.div(deathbyservice[&quot;0&quot;] + deathbyservice[&quot;1&quot;], axis=0)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FICU</th>
      <td>0.951613</td>
      <td>0.048387</td>
    </tr>
    <tr>
      <th>MICU</th>
      <td>0.826503</td>
      <td>0.173497</td>
    </tr>
    <tr>
      <th>SICU</th>
      <td>0.844196</td>
      <td>0.155804</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>It appears as though the <code class="docutils literal notranslate"><span class="pre">FICU</span></code> may have a lower rate of death than either the <code class="docutils literal notranslate"><span class="pre">MICU</span></code> or <code class="docutils literal notranslate"><span class="pre">SICU</span></code>. To compute an odds ratios, first compute the odds:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>deathbyservice[&quot;1&quot;].div(deathbyservice[&quot;0&quot;], axis=0)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FICU    0.050847
MICU    0.209917
SICU    0.184560
dtype: float64
</pre></div></div>
</div>
<p>And then we need to pick which of <code class="docutils literal notranslate"><span class="pre">FICU</span></code>, <code class="docutils literal notranslate"><span class="pre">MICU</span></code> or <code class="docutils literal notranslate"><span class="pre">SICU</span></code> will serve as the reference or baseline group. This is the group which the other two groups will be compared to. Again the choice is arbitrary, but should be dictated by the study objective. If this were a clinical trial with two drug arms and a placebo arm, it would be foolish to use one of the treatments as the reference group, particularly if you wanted to compare the efficacy of the treatments. In this particular case, there is
no clear reference group, but since the FICU is so much smaller than the other two units, we will use it as the reference group. Computing the odds ratio for MICU and SICU we get 4.13 and 3.63, respectively. These are also very strong associations, meaning that the odds of dying in the SICU and MICU are around 4 times higher than in the FICU, but relatively similar.</p>
<p>Contingency tables and 2x2 tables in particular are the building blocks of working with binary data, and it’s often a good way to begin looking at the data.</p>
</section>
<section id="Introducing-Logistic-Regression">
<h3>Introducing Logistic Regression<a class="headerlink" href="#Introducing-Logistic-Regression" title="Permalink to this heading">#</a></h3>
<p>Let’s fit this model, and see how this works using a real example. We fit logistic regression very similarly to how we fit linear regression models, with a few exceptions. First, we will use a new function called <code class="docutils literal notranslate"><span class="pre">glm</span></code>, which allow one to fit a class of models known as generalized linear models or GLMs. The <code class="docutils literal notranslate"><span class="pre">glm</span></code> function works in much the same way the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function does. We need to specify a formula of the form: <code class="docutils literal notranslate"><span class="pre">outcome</span> <span class="pre">~</span> <span class="pre">covariates</span></code>, specify what dataset to use (in our case the
<code class="docutils literal notranslate"><span class="pre">dat</span></code> data frame), and then specify the family. For logistic regression <code class="docutils literal notranslate"><span class="pre">family='binomial'</span></code> will be our choice. You can run the <code class="docutils literal notranslate"><span class="pre">summary</span></code> function, just like you did for <code class="docutils literal notranslate"><span class="pre">lm</span></code> and it produces output very similar to what <code class="docutils literal notranslate"><span class="pre">lm</span></code> did.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dat[&quot;day_28_flg&quot;] = np.where(dat[&quot;day_28_flg&quot;] == 0, 1, 0)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_new = ep.ad.df_to_anndata(dat)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;day_28_flg ~ age_cat&quot;
var_names = [&quot;day_28_flg&quot;, &quot;age_cat&quot;]

age_glm = ep.tl.glm(adata_new, var_names, formula, family=&quot;Binomial&quot;, missing=&quot;drop&quot;)
age_glm_result = age_glm.fit()
print(age_glm_result.summary())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         Generalized Linear Model Regression Results
==============================================================================================
Dep. Variable:     [&#39;day_28_flg[0]&#39;, &#39;day_28_flg[1]&#39;]   No. Observations:                 1776
Model:                                            GLM   Df Residuals:                     1774
Model Family:                                Binomial   Df Model:                            1
Link Function:                                  Logit   Scale:                          1.0000
Method:                                          IRLS   Log-Likelihood:                -674.34
Date:                                Wed, 25 May 2022   Deviance:                       1348.7
Time:                                        11:36:05   Pearson chi2:                 1.78e+03
No. Iterations:                                     6   Pseudo R-squ. (CS):             0.1111
Covariance Type:                            nonrobust
==================================================================================
                     coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept         -3.0944      0.162    -19.142      0.000      -3.411      -2.778
age_cat[T.&gt;55]     2.1740      0.179     12.175      0.000       1.824       2.524
==================================================================================
</pre></div></div>
</div>
<p>As you can see, we get a coefficients table that is similar to the <code class="docutils literal notranslate"><span class="pre">lm</span></code> table we used earlier. Instead of a <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">value</span></code>, we get a <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">value</span></code>, but this can be interpreted similarly. The rightmost column is a p-value, for testing the null hypothesis <span class="math notranslate nohighlight">\(\beta=0\)</span>. If you recall, the non-intercept coefficients are log-odds ratios, so testing if they are zero is equivalent to testing if the odds ratios are one. If an odds ratio is one the odds are equal in the numerator group and denominator
group, indicating the probabilities of the outcome are equal in each group. So, assessing if the coefficients are zero will be an important aspect of doing this type of analysis.</p>
<section id="Beyond-a-Single-Binary-Covariate">
<h4>Beyond a Single Binary Covariate<a class="headerlink" href="#Beyond-a-Single-Binary-Covariate" title="Permalink to this heading">#</a></h4>
<p>While the above analysis is useful for illustration, it does not readily demonstrate anything we could not do with our 2x2 table example above. Logistic regression allows us to extend the basic idea to at least two very relevant areas. The first is the case where we have more than one covariate of interest. Perhaps we have a confounder, we are concerned about, and want to adjust for it. Alternatively, maybe there are two covariates of interest. Secondly, it allows use to use covariates as
continuous quantities, instead of discretizing them into categories. For example, instead of dividing age up into exhaustive strata (as we did very simply by just dividing the patients into two groups, <span class="math notranslate nohighlight">\(\le55\)</span> and <span class="math notranslate nohighlight">\(&gt;55\)</span> ), we could instead use age as a continuous covariate.</p>
<p>First, having more than one covariate is simple. For example, if we wanted to add <code class="docutils literal notranslate"><span class="pre">service_unit</span></code> to our previous model, we could just add it as we did when using the <code class="docutils literal notranslate"><span class="pre">lm</span></code> function for linear regression. Here we specify <code class="docutils literal notranslate"><span class="pre">day_28_flg</span> <span class="pre">~</span> <span class="pre">age.cat</span> <span class="pre">+</span> <span class="pre">service_unit</span></code> and run the <code class="docutils literal notranslate"><span class="pre">summary</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;day_28_flg ~ age_cat + service_unit&quot;
var_names = [&quot;day_28_flg&quot;, &quot;age_cat&quot;, &quot;service_unit&quot;]

ageunit_glm = ep.tl.glm(
    adata_new, var_names, formula, family=&quot;Binomial&quot;, missing=&quot;drop&quot;
)
ageunit_glm_result = ageunit_glm.fit()
print(ageunit_glm_result.summary())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         Generalized Linear Model Regression Results
==============================================================================================
Dep. Variable:     [&#39;day_28_flg[0]&#39;, &#39;day_28_flg[1]&#39;]   No. Observations:                 1776
Model:                                            GLM   Df Residuals:                     1772
Model Family:                                Binomial   Df Model:                            3
Link Function:                                  Logit   Scale:                          1.0000
Method:                                          IRLS   Log-Likelihood:                -671.87
Date:                                Wed, 25 May 2022   Deviance:                       1343.7
Time:                                        11:36:06   Pearson chi2:                 1.74e+03
No. Iterations:                                     6   Pseudo R-squ. (CS):             0.1136
Covariance Type:                            nonrobust
========================================================================================
                           coef    std err          z      P&gt;|z|      [0.025      0.975]
----------------------------------------------------------------------------------------
Intercept               -4.2090      0.623     -6.761      0.000      -5.429      -2.989
age_cat[T.&gt;55]           2.1611      0.179     12.088      0.000       1.811       2.512
service_unit[T.MICU]     1.1789      0.615      1.915      0.055      -0.027       2.385
service_unit[T.SICU]     1.1234      0.614      1.830      0.067      -0.080       2.326
========================================================================================
</pre></div></div>
</div>
<p>A coefficient table is produced, and now we have four estimated coefficients. The same two, <code class="docutils literal notranslate"><span class="pre">(Intercept)</span></code> and <code class="docutils literal notranslate"><span class="pre">age_cat[T.&gt;55]</span></code> which were estimated in the unadjusted model, but also we have <code class="docutils literal notranslate"><span class="pre">service_unit[T.MICU]</span></code> and <code class="docutils literal notranslate"><span class="pre">service_unit[T.SICU]</span></code> which correspond to the log odds ratios for the MICU and SICU relative to the FICU. Taking the exponential of these will result in an odds ratio for each variable, adjusted for the other variables in the model. In this case the adjusted odds ratios for
Age&gt;55, MICU and SICU are 8.68, 3.25, and 3.08, respectively. We would conclude that there is an almost 9-fold increase in the odds of 28 day mortality for those in the <span class="math notranslate nohighlight">\(&gt;55\)</span> year age group relative to the younger <span class="math notranslate nohighlight">\(\le55\)</span> group while holding service unit constant. This adjustment becomes important in many scenarios where groups of patients may be more or less likely to receive treatment, but also more or less likely to have better outcomes, where one effect is confounded by possibly
many others. Such is almost always the case with observational data, and this is why logistic regression is such a powerful data analysis tool in this setting.</p>
<p>Another case we would like to be able to deal with is when we have a continuous covariate we would like to include in the model. One can always break the continuous covariate into mutually exclusive categories by selecting break or cut points, but selecting the number and location of these points can be arbitrary, and in many cases unnecessary or inefficient. Recall that in logistic regression we are fitting a model:</p>
<p><span class="math notranslate nohighlight">\(logit(p_x) = log(Odds_x) = log(\frac{p_x}{1-p_x}) = \beta_0 + \beta_1 \times x\)</span>,</p>
<p>but now assume <span class="math notranslate nohighlight">\(x\)</span> is continuous. Imagine a hypothetical scenario where you know <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span> and have a group of 50 year olds, and a group of 51 year olds. The difference in the log Odds between the two groups is:</p>
<p><span class="math notranslate nohighlight">\(log(Odds_{51}) -log(Odds_{50}) = (\beta_0 + \beta_1 \times 51) - (\beta_0 + \beta_1 \times 50) = \beta_1(51-50) = \beta_1\)</span>.</p>
<p>Hence, the odds ratio for 51 year olds versus 50 year olds is <span class="math notranslate nohighlight">\(\exp{(\beta_1)}\)</span>. This is actually true for any group of patients which are 1 year apart, and this gives a useful way to interpret and use these estimated coefficients for continuous covariates. Let’s work with an example. Again fitting the 28 day mortality outcome as a function of age, but treating age as it was originally recorded in the dataset, a continuous variable called <code class="docutils literal notranslate"><span class="pre">age</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>formula = &quot;day_28_flg ~ age&quot;
var_names = [&quot;day_28_flg&quot;, &quot;age&quot;]
agects_glm = ep.tl.glm(
    adata_new, var_names, formula, family=&quot;Binomial&quot;, missing=&quot;drop&quot;, ascontinus=[&quot;age&quot;]
)
agects_glm_result = agects_glm.fit()
print(agects_glm_result.summary())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         Generalized Linear Model Regression Results
==============================================================================================
Dep. Variable:     [&#39;day_28_flg[0]&#39;, &#39;day_28_flg[1]&#39;]   No. Observations:                 1776
Model:                                            GLM   Df Residuals:                     1774
Model Family:                                Binomial   Df Model:                            1
Link Function:                                  Logit   Scale:                          1.0000
Method:                                          IRLS   Log-Likelihood:                -625.49
Date:                                Wed, 25 May 2022   Deviance:                       1251.0
Time:                                        11:36:06   Pearson chi2:                 1.81e+03
No. Iterations:                                     6   Pseudo R-squ. (CS):             0.1587
Covariance Type:                            nonrobust
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -5.7780      0.321    -18.013      0.000      -6.407      -5.149
age            0.0652      0.004     14.595      0.000       0.056       0.074
==============================================================================
</pre></div></div>
</div>
<p>We see the estimated coefficient is 0.07 and still very statistically significant. Exponentiating the log odds ratio for age, we get an estimated odds ratio of 1.07, which is per 1 year increase in age. What if the age difference of interest is ten years instead of one year? There are at least two ways of doing this. One is to replace <code class="docutils literal notranslate"><span class="pre">age</span></code> with <code class="docutils literal notranslate"><span class="pre">I(age/10)</span></code>, which uses a new covariate which is <code class="docutils literal notranslate"><span class="pre">age</span></code> divided by ten. The second is to use the <code class="docutils literal notranslate"><span class="pre">agects.glm</span></code> estimated log odds ratio, and
multiple by ten prior to exponentiating. They will yield equivalent estimates of 1.92, but it is now per 10 year increases in age. This is useful when the estimated odds ratios (or log odds ratios) are close to one (or zero). When this is done, one unit of the covariate is 10 years, so the generic interpretation of the coefficients remains the same, but the units (per 10 years instead of per 1 year) changes.</p>
<p>This of course assumes that the form of our equation relating the log odds of the outcome to the covariate is correct. In cases where odds of the outcome decreases and increases as a function of the covariate, it is possible to estimate a relatively small effect of the linear covariate, when the outcome may be strongly affected by the covariate, but not in the way the model is specified. Assessing the linearity of the log odds of the outcome and some discretized form of the covariate can be done
graphically. For instance, we can break age into 5 groups, and estimate the log odds of 28 day mortality in each group.</p>
</section>
</section>
<section id="Hypothesis-Testing-and-Model-Selection">
<h3>Hypothesis Testing and Model Selection<a class="headerlink" href="#Hypothesis-Testing-and-Model-Selection" title="Permalink to this heading">#</a></h3>
<p>As was the case when using <code class="docutils literal notranslate"><span class="pre">lm</span></code>, we first fit the two competing models, a larger (alternative model), and a smaller (null model). Provided that the models are nested, our larger model is the one which contained <code class="docutils literal notranslate"><span class="pre">service_unit</span></code> and <code class="docutils literal notranslate"><span class="pre">age.cat</span></code>, and the smaller only contains <code class="docutils literal notranslate"><span class="pre">age.cat</span></code>, so they are nested. We are then testing if the log odds ratios for the two coefficients associated with <code class="docutils literal notranslate"><span class="pre">service_unit</span></code> are zero. Let’s call these coefficients <span class="math notranslate nohighlight">\(\beta_{MICU}\)</span> and <span class="math notranslate nohighlight">\(\beta_{SICU}\)</span>. To
test if <span class="math notranslate nohighlight">\(\beta_{MICU}\)</span> and <span class="math notranslate nohighlight">\(\beta_{SICU} = 0\)</span>, we can perform the following test:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># From https://stackoverflow.com/questions/27328623/anova-test-for-glm-in-python/60769343#60769343
from scipy import stats


def calculate_nested_f_statistic(small_model, big_model):
    &quot;&quot;&quot;Given two fitted GLMs, the larger of which contains the parameter space of the smaller, return the P value corresponding to the larger model adding explanatory power&quot;&quot;&quot;
    addtl_params = big_model.df_model - small_model.df_model
    f_stat = (small_model.deviance - big_model.deviance) / (
        addtl_params * big_model.scale
    )
    df_numerator = addtl_params
    df_denom = big_model.fittedvalues.shape[0] - big_model.df_model
    p_value = stats.f.sf(f_stat, df_numerator, df_denom)
    return p_value
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>p_value = calculate_nested_f_statistic(age_glm_result, ageunit_glm_result)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>table = [
    [&quot;Model 1:&quot;, &quot;day_28_flg ~ age_cat&quot;],
    [&quot;Model 2:&quot;, &quot;day_28_flg ~ age_cat + service_unit&quot;],
    [&quot;&quot;, &quot;Df Resid.&quot;, &quot;Dev.&quot;, &quot;Df&quot;, &quot;Pr(&gt;Chi)&quot;],
    [1, age_glm_result.df_resid, age_glm_result.deviance],
    [
        2,
        ageunit_glm_result.df_resid,
        ageunit_glm_result.deviance,
        ageunit_glm_result.df_model - age_glm_result.df_model,
        p_value,
    ],
]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(tabulate(table))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------  -----------------------------------  ------------------  --  -------------------
Model 1:  day_28_flg ~ age_cat
Model 2:  day_28_flg ~ age_cat + service_unit
          Df Resid.                            Dev.                Df  Pr(&gt;Chi)
1         1774                                 1348.6769051096794
2         1772                                 1343.74541569681    2   0.08523681019077513
--------  -----------------------------------  ------------------  --  -------------------
</pre></div></div>
</div>
<p>A couple good practices to get in a habit are to first make sure the two competing models are correctly specified. Here we are are testing <code class="docutils literal notranslate"><span class="pre">~</span> <span class="pre">age.cat</span></code> versus <code class="docutils literal notranslate"><span class="pre">age.cat</span> <span class="pre">+</span> <span class="pre">service_unit</span></code>. Next, the difference between the residual degrees of freedom (<code class="docutils literal notranslate"><span class="pre">Resid.</span> <span class="pre">Df</span></code>) in the two models tell us how many more parameters the larger model has when compared to the smaller model. Here we see <code class="docutils literal notranslate"><span class="pre">1774</span> <span class="pre">-</span> <span class="pre">1772</span> <span class="pre">=</span> <span class="pre">2</span></code> which means that there are two more coefficients estimated in the larger model than the smaller
one, which corresponds with the output from the <code class="docutils literal notranslate"><span class="pre">summary</span></code> table above. Next looking at the p-value (<code class="docutils literal notranslate"><span class="pre">Pr(&gt;Chi)</span></code>), we see a test for <span class="math notranslate nohighlight">\(\beta_{MICU}\)</span> and <span class="math notranslate nohighlight">\(\beta_{SICU} = 0\)</span> has a p-value of around 0.08. At the typical 0.05 significance level, we would not reject the null, and use the simpler model without the service unit. In logistic regression, this is a common way of testing whether a categorical covariate should be retained in the model, as it can be difficult to assess using the
<code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">value</span></code> in the <code class="docutils literal notranslate"><span class="pre">summary</span></code> table, particularly when one is very statistically significant, and one is not.</p>
</section>
<section id="Confidence-Intervals">
<h3>Confidence Intervals<a class="headerlink" href="#Confidence-Intervals" title="Permalink to this heading">#</a></h3>
<p>Generating confidence intervals for either the log-odds ratios or the odds ratios are relatively straightforward. To get the log-odds ratios and respective confidence intervals for the <code class="docutils literal notranslate"><span class="pre">ageunit_glm</span></code> model which includes both age and service unit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ageunit_glm_result.params
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Intercept              -4.209014
age_cat[T.&gt;55]          2.161142
service_unit[T.MICU]    1.178866
service_unit[T.SICU]    1.123443
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ageunit_glm_result.conf_int(alpha=0.05)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-5.429257</td>
      <td>-2.988771</td>
    </tr>
    <tr>
      <th>age_cat[T.&gt;55]</th>
      <td>1.810733</td>
      <td>2.511552</td>
    </tr>
    <tr>
      <th>service_unit[T.MICU]</th>
      <td>-0.027452</td>
      <td>2.385184</td>
    </tr>
    <tr>
      <th>service_unit[T.SICU]</th>
      <td>-0.079611</td>
      <td>2.326497</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Here the coefficient estimates and confidence intervals are presented in much the same way as for a linear regression. In logistic regression, it is often convenient to exponentiate these quantities to get it on a more interpretable scale.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>np.exp(ageunit_glm_result.params)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Intercept               0.014861
age_cat[T.&gt;55]          8.681049
service_unit[T.MICU]    3.250686
service_unit[T.SICU]    3.075425
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>np.exp(ageunit_glm_result.conf_int(alpha=0.025))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>0.003681</td>
      <td>0.059992</td>
    </tr>
    <tr>
      <th>age_cat[T.&gt;55]</th>
      <td>5.814857</td>
      <td>12.960011</td>
    </tr>
    <tr>
      <th>service_unit[T.MICU]</th>
      <td>0.818181</td>
      <td>12.915179</td>
    </tr>
    <tr>
      <th>service_unit[T.SICU]</th>
      <td>0.776964</td>
      <td>12.173333</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Similar to linear regression, we will look at if the confidence intervals for the log odds ratios include zero. This is equivalent to seeing if the intervals for the odds ratios include 1. Since the odds ratios are more directly interpretable it is often more convenient to report them instead of the coefficients on the log odds ratio scale.</p>
</section>
<section id="Prediction">
<h3>Prediction<a class="headerlink" href="#Prediction" title="Permalink to this heading">#</a></h3>
<p>Let’s first create a new data frame called <code class="docutils literal notranslate"><span class="pre">newdat</span></code> which computes all combinations of the values of variables passed to it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def expand_grid(dictionary):
    return pd.DataFrame(
        [row for row in product(*dictionary.values())], columns=dictionary.keys()
    )


dictionary = {&quot;age_cat&quot;: [&quot;&lt;=55&quot;, &quot;&gt;55&quot;], &quot;service_unit&quot;: [&quot;FICU&quot;, &quot;MICU&quot;, &quot;SICU&quot;]}

newdat = expand_grid(dictionary)
newdat
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age_cat</th>
      <th>service_unit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;=55</td>
      <td>FICU</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;=55</td>
      <td>MICU</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;=55</td>
      <td>SICU</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&gt;55</td>
      <td>FICU</td>
    </tr>
    <tr>
      <th>4</th>
      <td>&gt;55</td>
      <td>MICU</td>
    </tr>
    <tr>
      <th>5</th>
      <td>&gt;55</td>
      <td>SICU</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>newdat[&quot;pred&quot;] = ageunit_glm_result.predict(newdat)
newdat
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age_cat</th>
      <th>service_unit</th>
      <th>pred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;=55</td>
      <td>FICU</td>
      <td>0.014643</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;=55</td>
      <td>MICU</td>
      <td>0.046082</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;=55</td>
      <td>SICU</td>
      <td>0.043706</td>
    </tr>
    <tr>
      <th>3</th>
      <td>&gt;55</td>
      <td>FICU</td>
      <td>0.114268</td>
    </tr>
    <tr>
      <th>4</th>
      <td>&gt;55</td>
      <td>MICU</td>
      <td>0.295461</td>
    </tr>
    <tr>
      <th>5</th>
      <td>&gt;55</td>
      <td>SICU</td>
      <td>0.284056</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="Survival-Analysis">
<h2>Survival Analysis<a class="headerlink" href="#Survival-Analysis" title="Permalink to this heading">#</a></h2>
<section id="correct-the-observation">
<h3>correct the observation<a class="headerlink" href="#correct-the-observation" title="Permalink to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset = adata[
    :, [&quot;mort_day_censored&quot;, &quot;censor_flg&quot;, &quot;gender_num&quot;, &quot;service_unit&quot;]
]
</pre></div>
</div>
</div>
<p>Normally, you can skip the next step, but since this dataset was used to analyze the data in a slightly different way, we need to correct the observation times for a subset of the subjects in the dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset[:, [&quot;mort_day_censored&quot;]].X[adata_subset[:, [&quot;censor_flg&quot;]].X == 1] = 731
</pre></div>
</div>
</div>
</section>
<section id="Kaplan-Meier-Survival-Curves">
<h3>Kaplan-Meier Survival Curves<a class="headerlink" href="#Kaplan-Meier-Survival-Curves" title="Permalink to this heading">#</a></h3>
<p>Kaplan-Meier plots are one of the most widely used plots in medical research. We can use ehrapy.tools.kmp (ep.tl.kmp), which internally call KaplanMeierFitter, to fit the Kaplan-Meier estimate for the survival function. The function normally takes two arguments: a vector of times, and some kind of indicator for which patients had an event (death in our case). In our case, the vector of death and censoring times are the mort_day_censored, and deaths are coded with a zero in the censor_flg
variable.</p>
<p>Because in MIMIC-II database, <code class="docutils literal notranslate"><span class="pre">censor_fl</span></code> is censored or death (binary: 0 = death, 1 = censored). While in KaplanMeierFitter, <code class="docutils literal notranslate"><span class="pre">event_observed</span></code> is True if the the death was observed, False if the event was lost (right-censored). So we need to flip <code class="docutils literal notranslate"><span class="pre">censor_fl</span></code> when pass <code class="docutils literal notranslate"><span class="pre">censor_fl</span></code> to KaplanMeierFitter:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset[:, [&quot;censor_flg&quot;]].X = np.where(
    adata_subset[:, [&quot;censor_flg&quot;]].X == 0, 1, 0
)
</pre></div>
</div>
</div>
<p>Fitting a Kaplan-Meier curve is quite easy, and we want to ‘fit’ by gender (gender_num). The default alpha value of KaplanMeierFitter is 0.05, which is 95 % confidence intervals for the survival functions. Lastly we add a legend, coding black for the women and red for the men.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>T = adata_subset[:, [&quot;mort_day_censored&quot;]].X
E = adata_subset[:, [&quot;censor_flg&quot;]].X
groups = adata_subset[:, [&quot;gender_num&quot;]].X
ix1 = groups == 0
ix2 = groups == 1
kmf_1 = ep.tl.kmf(T[ix1], E[ix1], label=&quot;Women&quot;)
kmf_2 = ep.tl.kmf(T[ix2], E[ix2], label=&quot;Men&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ep.pl.kmf(
    [kmf_1, kmf_2],
    color=[&quot;k&quot;, &quot;r&quot;],
    xlim=[0, 750],
    ylim=[0, 1],
    xlabel=&quot;Days&quot;,
    ylabel=&quot;Proportion Who Survived&quot;,
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_112_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_112_0.png" />
</div>
</div>
<p>As the above figure shows, there appears to be a difference between the survival function between the two gender groups, with again the male group (red) dying at slightly slower rate than the female group (black). We have included 95 % point-wise confidence bands for the survival function estimate, which assesses how much certain we are about the estimated survivorship at each point in time.</p>
<p>We can do the same for service_unit, but since it has three groups, we need to change the color argument and legend to ensure the plot is properly labelled.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>groups = adata_subset[:, [&quot;service_unit&quot;]].X
ix1 = groups == &quot;FICU&quot;
ix2 = groups == &quot;MICU&quot;
ix3 = groups == &quot;SICU&quot;
kmf_1 = ep.tl.kmf(T[ix1], E[ix1], label=&quot;FICU&quot;)
kmf_2 = ep.tl.kmf(T[ix2], E[ix2], label=&quot;MICU&quot;)
kmf_3 = ep.tl.kmf(T[ix3], E[ix3], label=&quot;SICU&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ep.pl.kmf(
    [kmf_1, kmf_2, kmf_3],
    ci_show=[False, False, False],
    color=[&quot;k&quot;, &quot;r&quot;, &quot;g&quot;],
    xlim=[0, 750],
    ylim=[0, 1],
    xlabel=&quot;Days&quot;,
    ylabel=&quot;Proportion Who Survived&quot;,
    show=True,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_mimic_2_survival_analysis_115_0.png" src="../../_images/tutorials_notebooks_mimic_2_survival_analysis_115_0.png" />
</div>
</div>
</section>
<section id="Cox-Proportional-Hazards-Models">
<h3>Cox Proportional Hazards Models<a class="headerlink" href="#Cox-Proportional-Hazards-Models" title="Permalink to this heading">#</a></h3>
<p>The most popular approach for health data is likely the Cox Proportional Hazards Model, which is also sometimes called the Cox model or Cox Regression. As the name implies this method models something called the hazard function.</p>
<p>The hazard function is a function of time (hours, days, years) and is approximately the instantaneous probability of the event occurring (i.e., chance the event is happening in some very small time window) given the event has not already happened.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset = adata_subset[:, [&quot;mort_day_censored&quot;, &quot;censor_flg&quot;, &quot;gender_num&quot;]]
</pre></div>
</div>
</div>
<p>The CoxPHFitter function (from the lifelines package) is the fitting function for Cox models. In our case, let’s continue our example of using gender (gender_num) to model the datSurv outcome we created, and running the summary function to see what information is outputted.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset[:, [&quot;mort_day_censored&quot;]].X
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ArrayView([[11.92],
           [731.0],
           [731.0],
           ...,
           [62.21],
           [234.13],
           [731.0]], dtype=object)
</pre></div></div>
</div>
<p>Because CoxPHFitter.fit() needs DataFrame as input, we have to convert Anndata to DataFrame.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data = ep.ad.anndata_to_df(adata_subset)
data = data.dropna()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gender_coxph = CoxPHFitter()
gender_coxph.fit(data, duration_col=&quot;mort_day_censored&quot;, event_col=&quot;censor_flg&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;lifelines.CoxPHFitter: fitted with 1775 total observations, 1278 right-censored observations&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gender_coxph.print_summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>model</th>
      <td>lifelines.CoxPHFitter</td>
    </tr>
    <tr>
      <th>duration col</th>
      <td>'mort_day_censored'</td>
    </tr>
    <tr>
      <th>event col</th>
      <td>'censor_flg'</td>
    </tr>
    <tr>
      <th>baseline estimation</th>
      <td>breslow</td>
    </tr>
    <tr>
      <th>number of observations</th>
      <td>1775</td>
    </tr>
    <tr>
      <th>number of events observed</th>
      <td>497</td>
    </tr>
    <tr>
      <th>partial log-likelihood</th>
      <td>-3636.11</td>
    </tr>
    <tr>
      <th>time fit was run</th>
      <td>2022-05-25 09:36:08 UTC</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;">coef</th>
      <th style="min-width: 12px;">exp(coef)</th>
      <th style="min-width: 12px;">se(coef)</th>
      <th style="min-width: 12px;">coef lower 95%</th>
      <th style="min-width: 12px;">coef upper 95%</th>
      <th style="min-width: 12px;">exp(coef) lower 95%</th>
      <th style="min-width: 12px;">exp(coef) upper 95%</th>
      <th style="min-width: 12px;">cmp to</th>
      <th style="min-width: 12px;">z</th>
      <th style="min-width: 12px;">p</th>
      <th style="min-width: 12px;">-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gender_num</th>
      <td>-0.29</td>
      <td>0.75</td>
      <td>0.09</td>
      <td>-0.47</td>
      <td>-0.11</td>
      <td>0.63</td>
      <td>0.89</td>
      <td>0.00</td>
      <td>-3.24</td>
      <td>&lt;0.005</td>
      <td>9.71</td>
    </tr>
  </tbody>
</table><br><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>Concordance</th>
      <td>0.54</td>
    </tr>
    <tr>
      <th>Partial AIC</th>
      <td>7274.23</td>
    </tr>
    <tr>
      <th>log-likelihood ratio test</th>
      <td>10.43 on 1 df</td>
    </tr>
    <tr>
      <th>-log2(p) of ll-ratio test</th>
      <td>9.65</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The coefficients table has the familiar format, which we’ve seen before. The coef for gender_num is about −0.29, and this is the estimate of our log-hazard ratio. As discussed, taking the exponential of this gives the hazard ratio (HR), which the summary output computes in the next column (exp(coef)). Here, the HR is estimated at 0.75, indicating that men have about a 25 % reduction in the hazards of death, under the proportional hazards assumption.</p>
<p>The next column in the coefficient table has the standard error for the log hazard ratio, followed by the z score and p-value (Pr(&gt;|z|)), which is very similar to what we saw in the case of logistic regression. Here we see the p-value is quite small, and we would reject the null hypothesis that the hazard functions are the same between men and women. This is consistent with the exploratory figures we produced using Kaplan-Meier curves in the previous section.</p>
<p>For CoxPHFitter, the summary function also conveniently outputs the confidence interval of the HR a few lines down, and here our estimate of the HR is 0.75 (95 % CI: 0.63–0.89, p = 0.001). This is how the HR would typically be reported.</p>
<p>Using more than one covariate works the same as our other analysis techniques. Adding a co-morbidity to the model such as atrial fibrillation (afib_flg) can be done as you would do for logistic regression. Because fit a Cox Proportional Hazards Models using CoxPHFitter requires a Pandas DataFrame as input, we also need to create a DataFrame from AnnData.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>adata_subset = adata[:, [&quot;mort_day_censored&quot;, &quot;censor_flg&quot;, &quot;gender_num&quot;, &quot;afib_flg&quot;]]
data = ep.ad.anndata_to_df(adata_subset)
data = data.dropna()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mort_day_censored</th>
      <th>censor_flg</th>
      <th>gender_num</th>
      <th>afib_flg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>11.92</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>731.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>731.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>731.0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1771</th>
      <td>26.17</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1772</th>
      <td>3.21</td>
      <td>1</td>
      <td>0.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1773</th>
      <td>62.21</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1774</th>
      <td>234.13</td>
      <td>1</td>
      <td>1.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1775</th>
      <td>731.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>1775 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>genderafib_coxph = CoxPHFitter()
genderafib_coxph.fit(data, duration_col=&quot;mort_day_censored&quot;, event_col=&quot;censor_flg&quot;)
genderafib_coxph.print_summary()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>model</th>
      <td>lifelines.CoxPHFitter</td>
    </tr>
    <tr>
      <th>duration col</th>
      <td>'mort_day_censored'</td>
    </tr>
    <tr>
      <th>event col</th>
      <td>'censor_flg'</td>
    </tr>
    <tr>
      <th>baseline estimation</th>
      <td>breslow</td>
    </tr>
    <tr>
      <th>number of observations</th>
      <td>1775</td>
    </tr>
    <tr>
      <th>number of events observed</th>
      <td>497</td>
    </tr>
    <tr>
      <th>partial log-likelihood</th>
      <td>-3567.43</td>
    </tr>
    <tr>
      <th>time fit was run</th>
      <td>2022-05-25 09:36:09 UTC</td>
    </tr>
  </tbody>
</table>
</div><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 12px;"></th>
      <th style="min-width: 12px;">coef</th>
      <th style="min-width: 12px;">exp(coef)</th>
      <th style="min-width: 12px;">se(coef)</th>
      <th style="min-width: 12px;">coef lower 95%</th>
      <th style="min-width: 12px;">coef upper 95%</th>
      <th style="min-width: 12px;">exp(coef) lower 95%</th>
      <th style="min-width: 12px;">exp(coef) upper 95%</th>
      <th style="min-width: 12px;">cmp to</th>
      <th style="min-width: 12px;">z</th>
      <th style="min-width: 12px;">p</th>
      <th style="min-width: 12px;">-log2(p)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gender_num</th>
      <td>-0.26</td>
      <td>0.77</td>
      <td>0.09</td>
      <td>-0.44</td>
      <td>-0.08</td>
      <td>0.65</td>
      <td>0.92</td>
      <td>0.00</td>
      <td>-2.88</td>
      <td>&lt;0.005</td>
      <td>7.99</td>
    </tr>
    <tr>
      <th>afib_flg</th>
      <td>1.34</td>
      <td>3.84</td>
      <td>0.10</td>
      <td>1.14</td>
      <td>1.54</td>
      <td>3.14</td>
      <td>4.68</td>
      <td>0.00</td>
      <td>13.18</td>
      <td>&lt;0.005</td>
      <td>129.37</td>
    </tr>
  </tbody>
</table><br><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <tbody>
    <tr>
      <th>Concordance</th>
      <td>0.61</td>
    </tr>
    <tr>
      <th>Partial AIC</th>
      <td>7138.85</td>
    </tr>
    <tr>
      <th>log-likelihood ratio test</th>
      <td>147.80 on 2 df</td>
    </tr>
    <tr>
      <th>-log2(p) of ll-ratio test</th>
      <td>106.62</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Here again male gender is associated with reduced time to death, while atrial fibrillation increases the hazard of death by almost four-fold. Both are statistically significant in the summary output.</p>
<p>Cox regression also allows one to use covariates which change over time. This would allow one to incorporate changes in treatment, disease severity, etc. within the same patient without need for any different methodology. The major challenge to do this is mainly in the construction of the dataset, which is discussed in some of the references at the end of this chapter. Some care is required when the time dependent covariate is only measure periodically, as the method requires that it be known at
every event time for the entire cohort of patients, and not just those relevant to the patient in question. This is more practical for changes in treatment which may be recorded with some precision, particularly in a database like MIMIC II, and less so for laboratory results which may be measured at the resolution of hours, days or weeks. Interpolating between lab values or carrying the last observation forward has been shown to introduce several types of problems.</p>
</section>
<section id="Caveats-and-Conclusions">
<h3>Caveats and Conclusions<a class="headerlink" href="#Caveats-and-Conclusions" title="Permalink to this heading">#</a></h3>
<p>Survival analysis is distinguished from other forms of analyses covered in this Chapter, as it allows the data to be censored. As was the case for the other approaches we considered, there are modeling assumptions. For instance, it is important that the censoring is not informative of the survival time. For example, if censoring occurs when treatment is withdrawn because the patient is too sick to continue therapy, this would be an example of informative censoring. The validity of all methods
discussed in this section are then invalid. Care should be taken to make sure you understand the censoring mechanism as to avoid any false inferences drawn.</p>
<p>Assessment of the proportional hazards assumption is an important part of any Cox regression analysis. We refer you to the references at the end of this chapter for strategies and alternatives for when the proportional hazards assumption breaks down. In some circumstances, the proportional hazards assumption is not valid, and alternative approaches can be used. As is always the case, when outcomes are dependent (e.g., one patient may contribute more than one observation), the methods discussed
in this section should not be used directly. Generally the standard error estimates will be too small, and p-values will be incorrect. The concerns in logistic regression regarding outliers, co-linearity, missing data, and covariates with sparse outcomes apply here as well, as do the concerns about model misspecification for continuous covariates.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="diabetes_130.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Diabetes 130 Vignette</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mimic_2_fate.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">MIMIC-II Patient Fate</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, Lukas Heumos, Theislab
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">MIMIC-II Survival Analysis</a><ul>
<li><a class="reference internal" href="#Importing-ehrapy-and-setting-plotting-parameters">Importing ehrapy and setting plotting parameters</a></li>
<li><a class="reference internal" href="#MIMIC-II-dataset-preparation">MIMIC-II dataset preparation</a></li>
<li><a class="reference internal" href="#Linear-Regression">Linear Regression</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#Model-Selection">Model Selection</a><ul>
<li><a class="reference internal" href="#Statistical-Interactions-and-Testing-Nested-Models">Statistical Interactions and Testing Nested Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Reporting-and-Interpreting-Linear-Regression">Reporting and Interpreting Linear Regression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Logistic-Regression">Logistic Regression</a><ul>
<li><a class="reference internal" href="#2-*-2-Tables">2 * 2 Tables</a></li>
<li><a class="reference internal" href="#Introducing-Logistic-Regression">Introducing Logistic Regression</a><ul>
<li><a class="reference internal" href="#Beyond-a-Single-Binary-Covariate">Beyond a Single Binary Covariate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Hypothesis-Testing-and-Model-Selection">Hypothesis Testing and Model Selection</a></li>
<li><a class="reference internal" href="#Confidence-Intervals">Confidence Intervals</a></li>
<li><a class="reference internal" href="#Prediction">Prediction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Survival-Analysis">Survival Analysis</a><ul>
<li><a class="reference internal" href="#correct-the-observation">correct the observation</a></li>
<li><a class="reference internal" href="#Kaplan-Meier-Survival-Curves">Kaplan-Meier Survival Curves</a></li>
<li><a class="reference internal" href="#Cox-Proportional-Hazards-Models">Cox Proportional Hazards Models</a></li>
<li><a class="reference internal" href="#Caveats-and-Conclusions">Caveats and Conclusions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>